3-28-2024
---

Upgraded QBSC firmware from .189 to .190
Compiled plugin w/ API 3.67 by commenting out all code related to setting SYNC param.
Initially plugin wouldn't load. Dependency walker showed it was linking to NeuropixAPI_x64_3_67_dbg.dll.
Renaming NeuropixAPI_x64_3_67.dll to NeuropixAPI_x64_3_67_dbg.dll enabled the plugin to load properly.

I was able to connect to one headstage and one probe: 

[open-ephys] Scanning for devices...
[open-ephys]   Found 1 device.
[open-ephys]   Opening device on slot 4
[open-ephys]   Opened BS on slot 4
[open-ephys]   BS firmware: 2.0169
[open-ephys]     Searching for probes...
[open-ephys] Got HS part #: NPM_HSTC_ext     <-- Do we ignore this part #?
[open-ephys] Got HS part #: NPM_HS_32
[open-ephys]       Found 2.0 Phase 2C dual-dock headstage on port: 1
[open-ephys]   No headstage detected on port: 3
[open-ephys]   No headstage detected on port: 4
[open-ephys]    Found probe part number: NP2020
[open-ephys]    Found probe serial number: 22053112201

On subsequent connections randomly getting either error code 8 OR 2.0 probe headstage number:

[open-ephys] ***detectHeadstage failed w/ error code: 8
[open-ephys] Got HS part #: NPM_HS_01


Downgrading QBSC firmware back to .189 no longer gives wrong HS PN but rarely still getting error 8.
Created Ph2C Geometry based off NP2 multi shank class and Ph2C User Manual to validate probe. 
Added inner loop to read packets by base / source type 384 channels at a time to fill a 384 * 4 total buffer.
Currently assuming packet count for each base is the same and not resetting between bases. Need to validate this.

Changes required for compatibility with current plugin paradigm
---

1. Upgrade parallelized PortChecker b/c ports are no longer independent and connecting to multiple Ph2C probes will require extra checks.
We either have to scan ports serially and check that NPM_HS_32 is on port 1 or 3, if so, ensure that NPM_HSTC_ext is found on 3 or 4 respectively.
Otherwise, keep the parallel jobs but then validate port indeces before initiating connection to probes.

2. Modify basestation view in plugin editor. 
If NP2020 detected on port 1/3, show as dual dock and remove port circle on 2/4 respectively.

Questions for Bill/Jan: 

1. What to do about port 2/4 status LED, it currently remains red even if port 1/3 is connected/acquiring
    TODO: Try to open port 2/4 anyway and see if it is able to connect/change the status LED.